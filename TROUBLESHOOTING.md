# トラブルシューティングガイド

このドキュメントでは、flogアプリの使用中に発生する可能性のある問題とその解決方法を説明します。

## Google連携関連のエラー

### エラー1: "Google Drive APIが有効になっていません"

**エラーメッセージ:**
```
Google Drive API has not been used in project XXXXXX before or it is disabled.
```

**原因:**
Google Cloud ConsoleでGoogle Drive APIが有効になっていません。

**解決方法:**
1. [DRIVE_API_SETUP.md](DRIVE_API_SETUP.md) の手順に従ってDrive APIを有効化してください
2. APIの有効化には数分かかる場合があります
3. 有効化後、アプリからサインアウトして再度サインインしてください

---

### エラー2: "Spreadsheetが見つかりません"

**エラーメッセージ:**
```
File not found: [Spreadsheet ID]
Spreadsheetが見つかりません（ID: XXXXXX）
```

**原因:**
以下のいずれかの可能性があります：
1. Spreadsheet IDが間違っている
2. サインインしているGoogleアカウントにSpreadsheetへのアクセス権限がない
3. Spreadsheetが削除されている

**解決方法:**

#### 1. Spreadsheet IDを確認
Spreadsheet IDは、SpreadsheetのURLから取得できます：
```
https://docs.google.com/spreadsheets/d/【ここがSpreadsheet ID】/edit
```

例：
```
https://docs.google.com/spreadsheets/d/1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms/edit
                                    ↑━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━↑
                                              Spreadsheet ID
```

**正しいIDをコピーする手順:**
1. Google Sheetsで対象のSpreadsheetを開く
2. ブラウザのアドレスバーからURLをコピー
3. `/d/` と `/edit` の間の文字列のみをコピー
4. アプリの設定画面で入力

#### 2. アクセス権限を確認

**手順:**
1. Google Sheetsで対象のSpreadsheetを開く
2. 右上の「共有」ボタンをクリック
3. アプリでサインインしているGoogleアカウントが一覧に含まれているか確認
4. 含まれていない場合は、以下のいずれかの方法で共有：
   - **方法A（推奨）**: Googleアカウントのメールアドレスを追加し、「編集者」権限を付与
   - **方法B**: 「リンクを知っている全員」に変更し、「編集者」権限を設定

**注意:** 閲覧権限のみでは書き込みができないため、必ず「編集者」権限を付与してください。

#### 3. Spreadsheetの存在を確認

1. ブラウザで直接SpreadsheetのURLを開いてみる
2. 開けない場合は、Spreadsheetが削除されている可能性があります
3. 新しいSpreadsheetを作成し、そのIDをアプリに設定してください

---

### エラー3: "Google認証が必要です"

**エラーメッセージ:**
```
Google認証が必要です
```

**原因:**
Googleアカウントにサインインしていません。

**解決方法:**
1. アプリの設定画面を開く
2. 「Googleでサインイン」ボタンをタップ
3. Googleアカウントを選択
4. 必要な権限を承認

---

## アップロード関連のエラー

### エラー4: "重複ログの検出"

**エラーメッセージ:**
```
⚠️ 重複ログの検出
X件の重複ログが見つかりました。
```

**原因:**
既にアップロード済みのログを再度アップロードしようとしています。

**解決方法:**
1. **キャンセル**: アップロードをキャンセルします（推奨）
2. **続行（重複追加）**: Spreadsheetに重複したデータが追加されます

**注意:** 通常は「キャンセル」を選択してください。重複追加すると、Spreadsheet内に同じログが複数存在することになります。

---

### エラー5: ファイルアップロードエラー（個別）

**エラーメッセージ:**
```
ファイルアップロードエラー (ファイル名): [エラー詳細]
```

**原因:**
個別のメディアファイルのアップロードに失敗しました。

**影響:**
- 該当ファイルのURLはSpreadsheetに記録されません
- その他のログは正常にアップロードされます

**解決方法:**
1. インターネット接続を確認
2. ファイルが破損していないか確認
3. 再度アップロードを実行

---

## その他のエラー

### エラー6: 位置情報が取得できない

**エラーメッセージ:**
```
位置情報を取得できませんでした
```

**原因:**
- 位置情報権限が許可されていない
- GPSがオフになっている
- 屋内など、GPS信号が弱い場所にいる

**解決方法:**
1. 端末の設定で位置情報権限を確認
   - Android: 設定 → アプリ → flog → 権限 → 位置情報
   - iOS: 設定 → プライバシー → 位置情報サービス → flog
2. GPSをオンにする
3. 屋外や窓際など、GPS信号が届きやすい場所に移動

**注意:** 位置情報が取得できなくてもログは保存できます（位置情報なしで保存）。

---

### エラー7: 録音ができない

**エラーメッセージ:**
```
マイクのパーミッションが必要です
```

**原因:**
マイクへのアクセス権限が許可されていません。

**解決方法:**
1. 端末の設定でマイク権限を確認
   - Android: 設定 → アプリ → flog → 権限 → マイク
   - iOS: 設定 → プライバシー → マイク → flog
2. 権限を「許可」に変更
3. アプリを再起動

---

## 開発者向けトラブルシューティング

### ビルドエラー

#### 1. Driftコード生成エラー

**解決方法:**
```bash
flutter clean
flutter pub get
dart run build_runner clean
dart run build_runner build --delete-conflicting-outputs
```

#### 2. パッケージ競合エラー

**解決方法:**
```bash
flutter clean
flutter pub get
```

#### 3. プラットフォーム固有のエラー

**Android:**
```bash
flutter clean
cd android
./gradlew clean
cd ..
flutter run
```

**iOS:**
```bash
cd ios
pod install
cd ..
flutter clean
flutter run
```

---

## よくある質問

### Q1: 既にアップロードしたログを再アップロードできますか？

A: いいえ、`uploadedAt`が設定されているログは「未アップロード」リストに表示されません。データベースを直接編集しない限り、再アップロードはできません。

### Q2: Spreadsheetのフォーマットを変更できますか？

A: ヘッダー行は自動的に追加されます。手動で列を追加することは可能ですが、既存の列を削除したり順序を変更すると、次回アップロード時にフォーマットが崩れる可能性があります。

### Q3: メディアファイルだけを後からアップロードできますか？

A: いいえ、現在の実装では、ログデータとメディアファイルは同時にアップロードされます。

### Q4: Google Driveの容量を使いますか？

A: はい、メディアファイルはGoogle Driveにアップロードされるため、Googleアカウントのストレージ容量を使用します。

---

## サポート

上記の解決方法で問題が解決しない場合は、以下の情報を含めて開発者に報告してください：

1. エラーメッセージの全文
2. 発生したタイミング（ログ作成時、アップロード時など）
3. 使用している端末とOSバージョン
4. 再現手順

GitHub Issues: [リポジトリのIssuesページURL]
